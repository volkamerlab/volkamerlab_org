{{ define "main" }}
<section>
    <div class="content">
        <article>
            <header class="major">
                <h1>{{ .Title }}</h1>
            </header>
            {{ .Content }}
            <section>
                <header>
                    <h2>Group Leader</h2>
                </header>
                <div class="posts">
                    {{ range where .Site.Data.team.members ".status" "teamleader" }}
                    {{ partial "person" . }}
                    {{ end }}
                </div>
            </section>
            <section>
                <header>
                    <h2>Administrative Assistance</h2>
                </header>
                <div class="posts">
                    {{ range where .Site.Data.team.members ".status" "adminassistance" }}
                    {{ partial "person" . }}
                    {{ end }}
                </div>
            </section>
            <section>
                <header>
                    <h2>Members</h2>
                </header>
                <div class="posts">
                    {{ range where .Site.Data.team.members ".status" "member" }}
                    {{ partial "person" . }}
                    {{ end }}
                </div>
            </section>
            <section>
                <header>
                    <h2>Associated members</h2>
                </header>
                <div class="posts">
                    {{ range where .Site.Data.team.members ".status" "associate" }}
                    {{ partial "person" . }}
                    {{ end }}
                </div>
            </section>
            <section>
                <header>
                    <h2>Students</h2>
                </header>
                <div class="posts">
                    {{ range where .Site.Data.team.members ".status" "studentmember" }}
                    {{ partial "person" . }}
                    {{ end }}
                </div>
                <!--
                To roll back to old format, remove the above <div> above
                and substitute with the <ul> below.

                <ul>
                    {{ range where $.Site.Data.team.members ".status" "studentmember" }}
                    <li id="{{- .key -}}"><strong>{{ with .prefix }}{{- . }} {{ end }}{{ .name }}</strong> ({{ .role }})<br />
                        {{ .project }}</li>
                    {{ end }}
                </ul>
-->
            </section>
            <section>
                <header>
                    <h2>Alumni</h2>
                </header>

                {{ $alumni := where $.Site.Data.team.members ".status" "alumni" }}
                {{ $years := slice }}
                {{ range $alumni }}
                    {{ if .left_date }}
                        {{ $year := dateFormat "2006" .left_date }}
                        {{ $years = $years | append $year }}
                    {{ end }}
                {{ end }}
                {{ $years = sort (uniq $years) "value" "desc" }}

                {{ range $years }}
                    {{ $currentYear := . }}
                    {{ $yearAlumni := slice }}
                    {{ range $alumni }}
                        {{ if .left_date }}
                            {{ $alumniYear := dateFormat "2006" .left_date }}
                            {{ if eq $alumniYear $currentYear }}
                                {{ $yearAlumni = $yearAlumni | append . }}
                            {{ end }}
                        {{ end }}
                    {{ end }}
                    {{ if $yearAlumni }}
                        <h3>{{ $currentYear }}</h3>
                        <ul>
                            {{ range sort $yearAlumni ".left_date" "desc" }}
                            <li id="{{- .key -}}"><strong>{{ with .prefix }}{{- . }} {{ end }}{{ .name }}</strong> ({{ .role }})
                                <a href="{{ .contact_link }}" target="_blank">{{ with .contact_text }}{{- . }} {{ end }}</a>
                                <br />
                                {{ .project }}
                            </li>
                            {{ end }}
                        </ul>
                    {{ end }}
                {{ end }}

                {{ $unknownAlumni := where $alumni ".left_date" "eq" nil }}
                {{ if $unknownAlumni }}
                    <h3>Previous Years</h3>
                    <ul>
                        {{ range $unknownAlumni }}
                        <li id="{{- .key -}}"><strong>{{ with .prefix }}{{- . }} {{ end }}{{ .name }}</strong> ({{ .role }})
                            <a href="{{ .contact_link }}" target="_blank">{{ with .contact_text }}{{- . }} {{ end }}</a>
                            <br />
                            {{ .project }}
                        </li>
                        {{ end }}
                    </ul>
                {{ end }}
            </section>
        </article>
    </div>
</section>
{{ end }}
